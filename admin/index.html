<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æœ¨å­AI åå°ç®¡ç†</title>
    <style>
      .cms-diagnostic {
        position: fixed;
        top: 80px;
        right: 20px;
        width: 420px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 3px 12px rgba(0,0,0,0.1);
        padding: 20px;
        font-family: "Microsoft YaHei", sans-serif;
        z-index: 9999;
        display: none;
      }
      .cms-diagnostic h3 {
        margin-top: 0;
        color: #D32F2F;
      }
      .cms-log { margin: 6px 0; padding: 8px 10px; border-radius: 6px; }
      .ok { background: #e8f5e9; color: #2e7d32; }
      .warn { background: #fff8e1; color: #ef6c00; }
      .err { background: #ffebee; color: #c62828; }
    </style>
  </head>
  <body>
    <!-- âœ… ä½¿ç”¨ jsDelivr é•œåƒï¼ˆé˜²æ­¢ unpkg è¢«å¢™ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/decap-cms@2.15.72/dist/decap-cms.js"></script>
    <script>
      CMS.init();

      // æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰é¢æ¿ â€œç³»ç»Ÿæ£€æµ‹â€
      CMS.registerPage({
        id: "system-check",
        title: "ğŸ§© ç³»ç»Ÿæ£€æµ‹",
        icon: "settings",
        render: () => {
          const container = document.createElement("div");
          container.classList.add("cms-diagnostic");
          container.style.display = "block";
          container.innerHTML = `<h3>Decap CMS ç³»ç»Ÿæ£€æµ‹ä¸­...</h3><div id="cms-result">è¯·ç¨å€™...</div>`;
          document.body.appendChild(container);
          runDiagnostics();
          return container;
        },
      });

      // è¿è¡Œæ£€æµ‹é€»è¾‘
      async function runDiagnostics() {
        const result = document.getElementById("cms-result");
        const logs = [];
        const log = (msg, type = "ok") => logs.push(`<div class="cms-log ${type}">${msg}</div>`);

        const configUrl = window.location.origin + "/plus/admin/config.yml";
        log("ğŸ” æ­£åœ¨æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„: " + configUrl);

        try {
          const res = await fetch(configUrl);
          if (!res.ok) throw new Error("HTTP çŠ¶æ€ç : " + res.status);
          const text = await res.text();
          if (text.includes("collections:")) log("âœ… æ‰¾åˆ° config.ymlï¼Œæ£€æµ‹åˆ° collections é¡¹ã€‚");
          else log("âš ï¸ æ‰¾åˆ° config.ymlï¼Œä½†ç¼ºå°‘ collections å­—æ®µã€‚", "warn");

          // æ£€æŸ¥ CDN è„šæœ¬å¯è®¿é—®æ€§
          const jsUrl = "https://cdn.jsdelivr.net/npm/decap-cms@2.15.72/dist/decap-cms.js";
          const jsRes = await fetch(jsUrl);
          if (jsRes.ok) log("âœ… Decap CMS æ ¸å¿ƒè„šæœ¬åŠ è½½æ­£å¸¸ã€‚");
          else log("âŒ Decap CMS è„šæœ¬åŠ è½½å¤±è´¥: " + jsUrl, "err");

          log("ğŸŸ¢ ç³»ç»Ÿæ£€æµ‹å®Œæˆã€‚");
        } catch (e) {
          log("âŒ æ£€æµ‹å¤±è´¥: " + e.message, "err");
        }

        result.innerHTML = logs.join("");
      }
    </script>
  </body>
</html>
