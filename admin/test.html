<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Decap CMS é…ç½®æ£€æµ‹</title>
  <style>
    body { font-family: "Microsoft YaHei", sans-serif; background: #fafafa; padding: 40px; }
    h1 { color: #D32F2F; }
    .log { padding: 10px; margin: 10px 0; border-radius: 6px; }
    .ok { background: #e0f2f1; color: #00796b; }
    .warn { background: #fff3e0; color: #ef6c00; }
    .err { background: #ffebee; color: #c62828; }
  </style>
</head>
<body>
  <h1>ğŸ” Decap CMS åå°æ£€æµ‹å·¥å…·</h1>
  <div id="result">æ­£åœ¨æ£€æµ‹ï¼Œè¯·ç¨å€™...</div>

  <script>
    async function testDecapCMS() {
      const result = document.getElementById("result");
      const baseUrl = window.location.origin + "/plus/admin/config.yml";
      const logs = [];

      function log(msg, type = "ok") {
        logs.push(`<div class="log ${type}">${msg}</div>`);
      }

      try {
        log("ğŸ” æ­£åœ¨è¯·æ±‚é…ç½®æ–‡ä»¶ï¼š" + baseUrl);
        const res = await fetch(baseUrl);
        if (!res.ok) throw new Error("HTTPçŠ¶æ€ç ï¼š" + res.status);

        const text = await res.text();

        // æ£€æŸ¥å†…å®¹ç»“æ„
        if (text.includes("collections:")) {
          log("âœ… æ‰¾åˆ° config.ymlï¼Œå¹¶æ£€æµ‹åˆ° collections é…ç½®é¡¹ã€‚");
        } else {
          log("âš ï¸ æ‰¾åˆ° config.ymlï¼Œä½†æœªæ£€æµ‹åˆ° collectionsï¼Œå¯èƒ½æ ¼å¼ä¸æ­£ç¡®ã€‚", "warn");
        }

        // æ£€æŸ¥ YAML æ ¼å¼é—®é¢˜ï¼ˆç®€å•æ­£åˆ™ï¼‰
        if (/^\s|\t/.test(text)) {
          log("âš ï¸ æ£€æµ‹åˆ°ç¼©è¿›å¼‚å¸¸ï¼ˆå« Tab æˆ–å‰å¯¼ç©ºæ ¼ä¸è§„åˆ™ï¼‰ã€‚", "warn");
        }

        // æ£€æŸ¥ Decap åˆå§‹åŒ–è„šæœ¬æ˜¯å¦å¯è®¿é—®
        const jsUrl = "https://unpkg.com/decap-cms@2.15.72/dist/decap-cms.js";
        const jsRes = await fetch(jsUrl);
        if (jsRes.ok) {
          log("âœ… Decap CMS æ ¸å¿ƒè„šæœ¬åŠ è½½æ­£å¸¸ã€‚");
        } else {
          log("âŒ æ— æ³•åŠ è½½ Decap CMS æ ¸å¿ƒè„šæœ¬ï¼š" + jsUrl, "err");
        }

        log("ğŸ§© æ£€æµ‹å®Œæˆï¼å¦‚æœä¸€åˆ‡ä¸ºç»¿è‰²ï¼Œåˆ™åå°åº”å¯æ­£å¸¸è®¿é—®ã€‚");

      } catch (err) {
        log("âŒ æ£€æµ‹å¤±è´¥ï¼š" + err.message, "err");
      }

      result.innerHTML = logs.join("");
    }

    testDecapCMS();
  </script>
</body>
</html>
