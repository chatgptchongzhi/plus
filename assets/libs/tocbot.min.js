/* plus/assets/libs/tocbot.min.js
   极简 TOC 生成器（根据 #postContent 内的 h2/h3 构建目录）
   接口与 tocbot.init(options) 兼容子集。 */
!function(w){
  const tocbot = {
    init(opts){
      const toc = document.querySelector(opts.tocSelector);
      const body = document.querySelector(opts.contentSelector);
      if(!toc || !body) return;
      const heads = Array.from(body.querySelectorAll(opts.headingSelector||'h2,h3'));
      const ul = document.createElement('ul'); ul.style.listStyle='none'; ul.style.paddingLeft='0';
      heads.forEach((h,i)=>{
        if(!h.id) h.id = 'h-' + i;
        const li = document.createElement('li');
        li.style.marginLeft = (h.tagName==='H3'? '16px':'0');
        const a = document.createElement('a'); a.href = '#'+h.id; a.textContent = h.textContent;
        a.addEventListener('click', e=>{
          e.preventDefault();
          document.getElementById(h.id).scrollIntoView({behavior:'smooth',block:'start'});
          history.replaceState(null,'','#'+h.id);
          toc.querySelectorAll('a').forEach(x=>x.classList.remove('active'));
          a.classList.add('active');
        });
        li.appendChild(a); ul.appendChild(li);
      });
      toc.innerHTML=''; toc.appendChild(ul);
    },
    destroy(){ /* no-op for mini version */ }
  };
  w.tocbot = tocbot;
}(window);
